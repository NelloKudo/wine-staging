From fb66d84bc6b98c261d6219b29923b9b7590766d6 Mon Sep 17 00:00:00 2001
From: David Torok <dt@zeroitlab.com>
Date: Sun, 17 Nov 2019 19:08:12 +0100
Subject: [PATCH] Send WM_NCPOINTERUP on focus regain

---
 dlls/win32u/input.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/dlls/win32u/input.c b/dlls/win32u/input.c
index 81c29af9b96..f1c5e418e00 100644
--- a/dlls/win32u/input.c
+++ b/dlls/win32u/input.c
@@ -2016,6 +2016,9 @@ BOOL set_active_window( HWND hwnd, HWND *prev, BOOL mouse, BOOL focus, DWORD new
         send_message( hwnd, WM_ACTIVATE,
                       MAKEWPARAM( mouse ? WA_CLICKACTIVE : WA_ACTIVE, is_iconic(hwnd) ),
                       (LPARAM)previous );
+
+        send_message( hwnd, WM_NCPOINTERUP, 0, 0);
+
         if (NtUserGetAncestor( hwnd, GA_PARENT ) == get_desktop_window())
             NtUserPostMessage( get_desktop_window(), WM_PARENTNOTIFY, WM_NCACTIVATE, (LPARAM)hwnd );
     }
-- 
2.47.2

