From c9f90dfeff20eb7faa55bdc00add8f4d18fbb1b5 Mon Sep 17 00:00:00 2001
From: Alistair Leslie-Hughes <leslie_alistair@hotmail.com>
Date: Wed, 8 Feb 2023 14:16:24 +1100
Subject: [PATCH] odbc32: SQLBindCol convert to ODBC2 types if required

---
 dlls/odbc32/proxyodbc.c | 14 ++++++++++++++
 1 file changed, 14 insertions(+)

diff --git a/dlls/odbc32/proxyodbc.c b/dlls/odbc32/proxyodbc.c
index 6e02d37548c..d760481fa9b 100644
--- a/dlls/odbc32/proxyodbc.c
+++ b/dlls/odbc32/proxyodbc.c
@@ -465,6 +465,20 @@ SQLRETURN WINAPI SQLBindCol(SQLHSTMT StatementHandle, SQLUSMALLINT ColumnNumber,
 
     if (statement->connection->pSQLBindCol)
     {
+        /*
+         * Map ODBC3 Datatype back to ODBC2 types when the application has asked for SQL_OV_ODBC2.
+         * Some drivers rely on this (PostgreSQL odbc driver).
+         */
+        if (statement->connection->environment->version == SQL_OV_ODBC2)
+        {
+            if(TargetType == SQL_C_TYPE_TIME)
+                TargetType = SQL_C_TIME;
+            else if(TargetType == SQL_C_TYPE_DATE)
+                TargetType = SQL_C_DATE;
+            else if(TargetType == SQL_C_TYPE_TIMESTAMP)
+                TargetType = SQL_C_TIMESTAMP;
+        }
+
         ret = statement->connection->pSQLBindCol(statement->driver_stmt, ColumnNumber, TargetType,
                             TargetValue, BufferLength, StrLen_or_Ind);
     }
-- 
2.43.0

